# ENVI 光谱数据处理器


[![English](https://img.shields.io/badge/Language-English-blue)](README.md)
[![中文](https://img.shields.io/badge/语言-中文-red)](README中文.md)

用于处理 ENVI ASCII 绘图文件（.txt）并将特定光谱数据列提取为 CSV 格式的 Python 脚本，便于分析和可视化。

## 描述

此脚本通过以下方式自动转换 ENVI 光谱数据文件：
- 读取脚本所在当前目录中的多个 .txt 文件
- 跳过头部信息（前 7 行）
- 从 6 列光谱数据中提取波长（第 1 列）和平均值（第 4 列）
- 将提取的数据保存为带有适当标题的 CSV 文件到同一目录

非常适合使用 ENVI 软件分析宝石、矿物或其他材料的高光谱数据的研究人员和分析师。该脚本具有可移植性，可在任何包含 ENVI 光谱数据文件的目录中使用。

## 系统要求

- **Python 3.6 或更高版本**
- **Python 标准库**（无需额外安装包）：
  - `os` - 文件系统操作
  - `csv` - CSV 文件处理
  - `glob` - 文件模式匹配
  - `pathlib` - 路径处理

## 文件结构要求

### 输入文件夹结构

```
您的工作目录/
├── 1 天然翡翠.txt               # 示例光谱数据文件
├── 2 翡翠B货.txt                # 示例光谱数据文件
├── ...                         # 其他 .txt 文件
└── process_spectral_data.py    # 处理脚本
```

**注意**：脚本处理其所在目录中的所有 .txt 文件。无需特定的文件夹结构。

### 输入文件格式规范

每个 .txt 文件必须遵循以下确切结构：

#### 第 1-7 行：头部信息（将被跳过）

```
ENVI ASCII Plot File [Mon Jul 07 14:50:29 2025]
Column 1: Wavelength
Column 2: Min: ROI #8~~2##255,0,0
Column 3: Mean-StdDev: ROI #8~~21##0,200,0
Column 4: Mean: ROI #8~~0##0,0,0
Column 5: Mean+StdDev: ROI #8~~21##0,200,0
Column 6: Max: ROI #8~~2##255,0,0
```

#### 第 8 行及以后：数据行（每行 6 列）

```
   399.360998  0.000000  0.056124  0.136450  0.216776  0.518519
   400.982707  0.000000  0.083957  0.158695  0.233433  0.432099
   402.604417  0.000000  0.092514  0.163083  0.233652  0.380435
   ...
```

## 安装说明

1. **下载脚本**：将 `process_spectral_data.py` 保存到包含您的 .txt 光谱数据文件的目录中

2. **验证 Python 安装**：
   ```bash
   python --version
   ```
   确保您安装了 Python 3.6 或更高版本。

3. **准备数据**：
   - 将脚本放在与您的 .txt 光谱数据文件相同的目录中
   - 无需特定的文件夹结构

4. **无需额外依赖**：脚本仅使用 Python 标准库。

## 使用说明

### 分步指南

1. **在包含您的 .txt 文件和脚本的目录中打开终端/命令提示符**

2. **运行脚本**：
   ```bash
   python process_spectral_data.py
   ```

3. **监控进度**：脚本将显示：
   - 正在处理的当前目录
   - 找到的文件数量
   - 每个文件的处理状态
   - 每个文件提取的数据行数
   - 最终摘要

4. **检查结果**：CSV 文件将在与 .txt 文件相同的目录中创建

### 预期输出

```
Processing .txt files in: C:\Users\用户名\Desktop\光谱数据
Found 64 .txt files to process...
--------------------------------------------------
Successfully processed: 1 天然翡翠.txt -> 1 天然翡翠.csv
  Extracted 372 data rows

Successfully processed: 2 翡翠B货.txt -> 2 翡翠B货.csv
  Extracted 372 data rows

...

--------------------------------------------------
Processing complete! Successfully processed 64 files.
CSV files have been saved in the current directory: C:\Users\用户名\Desktop\光谱数据
```

## 输入文件格式详情

### 头部结构（第 1-7 行）

| 行号 | 内容 | 用途 |
|------|------|------|
| 1 | `ENVI ASCII Plot File [时间戳]` | 文件类型标识符 |
| 2 | `Column 1: Wavelength` | 第 1 列描述 |
| 3 | `Column 2: Min: ROI #...` | 第 2 列描述 |
| 4 | `Column 3: Mean-StdDev: ROI #...` | 第 3 列描述 |
| 5 | `Column 4: Mean: ROI #...` | 第 4 列描述（将被提取） |
| 6 | `Column 5: Mean+StdDev: ROI #...` | 第 5 列描述 |
| 7 | `Column 6: Max: ROI #...` | 第 6 列描述 |

### 数据结构（第 8 行及以后）

- **格式**：6 列，用空格分隔
- **第 1 列**：波长值（nm）- **将被提取**
- **第 2 列**：最小值
- **第 3 列**：平均值减去标准差
- **第 4 列**：平均值 - **将被提取**
- **第 5 列**：平均值加上标准差
- **第 6 列**：最大值

## 输出格式

### CSV 文件结构

```csv
Wavelength,Mean
399.360998,0.13645
400.982707,0.158695
402.604417,0.163083
404.226127,0.149646
405.847836,0.16018
...
```

### 文件命名约定

- **输入**：`原始文件名.txt`
- **输出**：`原始文件名.csv`
- **位置**：与输入文件和脚本相同的目录

## 示例

### 示例输入文件（`1 天然翡翠.txt`）

```
ENVI ASCII Plot File [Mon Jul 07 14:50:29 2025]
Column 1: Wavelength
Column 2: Min: ROI #8~~2##255,0,0
Column 3: Mean-StdDev: ROI #8~~21##0,200,0
Column 4: Mean: ROI #8~~0##0,0,0
Column 5: Mean+StdDev: ROI #8~~21##0,200,0
Column 6: Max: ROI #8~~2##255,0,0
   399.360998  0.000000  0.056124  0.136450  0.216776  0.518519
   400.982707  0.000000  0.083957  0.158695  0.233433  0.432099
   402.604417  0.000000  0.092514  0.163083  0.233652  0.380435
```

### 生成的输出文件（`1 天然翡翠.csv`）

```csv
Wavelength,Mean
399.360998,0.136450
400.982707,0.158695
402.604417,0.163083
```

## 错误处理

脚本包含针对以下情况的全面错误处理：

### 常见问题和解决方案

| 问题 | 错误信息 | 解决方案 |
|------|----------|----------|
| 无 .txt 文件 | `No .txt files found in the current directory` | 将 .txt 文件添加到目录或将脚本移动到正确位置 |
| 无效数据格式 | `Warning: Could not parse line X` | 检查文件格式是否符合规范 |
| 列数不足 | `Warning: Line X has fewer than 4 columns` | 验证数据完整性 |
| 文件访问问题 | `Error processing filename.txt: [详情]` | 检查文件权限 |

### 数据验证

- **空行**：自动跳过
- **格式错误的数据**：记录行号
- **缺失列**：报告但继续处理
- **无效数字**：记录转换错误

## 文件组织

### 处理前

```
光谱数据目录/
├── 1 天然翡翠.txt
├── 2 翡翠B货.txt
├── 3 翡翠B+C.txt
├── ...
└── process_spectral_data.py
```

### 处理后

```
光谱数据目录/
├── 1 天然翡翠.txt
├── 1 天然翡翠.csv          # ← 新的 CSV 文件
├── 2 翡翠B货.txt
├── 2 翡翠B货.csv           # ← 新的 CSV 文件
├── 3 翡翠B+C.txt
├── 3 翡翠B+C.csv           # ← 新的 CSV 文件
├── ...
└── process_spectral_data.py
```

## 故障排除

### 脚本无法运行

1. **检查 Python 安装**：`python --version`
2. **验证文件位置**：确保脚本与您的 .txt 文件在同一目录中
3. **检查文件权限**：确保您对目录有读/写访问权限

### 未处理文件

1. **验证 .txt 文件存在**：在与脚本相同的目录中
2. **检查文件扩展名**：必须是 `.txt`（区分大小写）
3. **确保文件不为空**或未损坏

### 数据提取不完整

1. **检查文件格式**：验证 7 行头部结构
2. **验证数据列**：确保每个数据行有 6 列
3. **查看错误信息**：检查控制台输出中的具体问题

### 性能问题

- **大文件**：处理时间随文件大小增加
- **多文件**：为每个文件报告进度
- **内存使用**：脚本逐个处理文件

## 技术支持

如有问题或疑问：

1. 检查控制台输出中的错误信息
2. 验证您的输入文件是否符合预期格式
3. 确保满足所有先决条件
4. 查看上述故障排除部分

---

**脚本版本**：1.0  
**兼容性**：Python 3.6+  
**最后更新**：2025年7月
